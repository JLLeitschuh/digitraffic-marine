<html>
<head>
    <title>Testiclient for vessel locations</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" ></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.0.3/sockjs.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

    <script>
        var notAllowed = [230982910,276790000,230061510,230053240,265704430,276690000,230987140,230035000,276103000,276152000,230025680,230002550,230940400,230941050,230069190,230117380,230346000,230061850,276385000,230063680,230985650,230665000,230981680,276209000,276659000,266101000,273425630,276167000,276377000,276787000,276001830,276785000,230987510,230122280,230942640,230996210,230993160,230984790,230001770,276761000,276282000,230052950,230996080,230996190,276326000,230083540,230983690,276182000,276299000,276187000,276174000,276643000,276276000,230987350,266011000,266180000,230942350,230012000,265759000,277538000,277543000,273391590,230070270,277290000,276811000,276371000,276381000,276825000,230996360,230996350,265630900,277233000,230627000,230941650,276370000,230941710,275412000];
        var allowed = [230111690,212411000,230351000,273353110,230630000,636092345,276077000,230947000,273335380,230081250,230012710,244024000,230107940,311126000,265623130,246279000,230928000,230022010,236644000,230992610,230005000,276504000,230916000,273336230,238249000,636017647,616846000,265514760,249742000,212204000,259743000,111265581,231790000,212123000,245229000,230938960,265520390,305741000,376384000,230091080,304919000,219511000,276796000,273358930,265088000,265546940,235073548,245306000,265730240,240110000,212456000,309504000,265585310,236146000,273444280,304880000,210329000,538005534,356182000,676362000,273317900,245717000,209204000,211135000,244693000,212464000,246519000,266103000,273318800,210716000,305166000,636012244,244847000,636013897,230649000,218800000,311000577,311676000,219291000,246507000,233150000,219425000,273330940,246630000,538003952,230005650,230005600,235095162,376553000,246499000,244790370,276823000,636015737,230358000,276781000,245299000,209179000,245219000,311028300,231201000,265528060,273362290,248364000,636091104,235050837,230125940,230957000,538005467,229868000,236175000,235077249,374322000,664445000,305117000,246386000,215061000,636092694,236465000,235000970,258894000,273339540,305862000,241214000,248070000,305484000,230981000,305506000,304520000,249446000,311003700,265425000,305394000,273315800,255735000,538005693,210605000,245867000,230368000,230018670,230926000,230995840,273340630,249327000,245391000,636016601,273335780,305804000,636013841,230984000,244562000,273385430,273335920,273435190,305846000,375581000,240185000,273358610,273325400,273351080,305777000,273310710,273433720,230625000,273424720,246866000,246230000,273331620,636015601,273343630,538003561,538005539,636013650,229883000,230608000,211845000,244613000,372176000,255804340,273390270,236124000,372002000,247661000,230938210,212369000,276756000,209808000,244850075,230949000,230109460,212130000,620084000,276197000,230993790,245921000,230981750,235076013,230992970,230992740,276797000,210035000,616845000,230994610,230987260,230184000,538006488,241385000,236576000,244575000,230111470,230980000,636015361,230637000,230993760,230289000,230178000,230111070,230006380,230992510,230993710,230992370,236610000,218085000,276718000,230944000,248306000,230112280,230071310,276585000,259002000,231695000,230662000,230359000,276672000,266192000,240307000,259255000,273348430,230939370,371760000,230980260,273354450,564970000,230938240,266419000,276780000,538005170,230117660,276297000,230109450,230987380,230940310,230938590,265588910,230990270,211379750,246629000,230988890,230007000,230111240,230934000,230111210,230014710,230298000,230110880,236111943,305982000,230196000,230938640,230992650,236306000,230006760,230081700,230628000,276260000,246555000,230111080,265150000,538005239,230639000,230005150,266314000,212360000,230992660,276776000,230234000,212018000,246456000,246556000,277449000,240435000,273338330,230286000,312074000,230084710,276158000,230931000,246190000,230995660,305896000,230251000,229611000,230942840,244621000,230990040,230915000,230028670,230180000,230053270,220441000,249145000,230992480,230252000,265735000,230956000,246276000,518898000,230618000,247283200,230991710,238234000,273336380,230046990,230635000,636092747,230660000,276779000,304786000,538090304,276538000,305335000,230035440,235000940,230940340,230061040,215357000,230643000,230941680,230989410,255804960,304616000,230111410,230940560,276817000,230108590,230914000,219165000,265412000,230981050,304001000,256770000,215178000,248071000,273380520,230025480,245086000,636091136,230988090,230025450,244874000,230337000,230113760,230014910,259768000,211440030,305916000,310133000,230361000,230624000,230636000,266248000,230110440,209263000,230989260,230005750,273247410,230045250,230938250,235009040,273390690,230282000,265546910,230011480,246606000,230028680,23093936,273338790,246639000,636092745,209724000,230650000,230993680,273443280,276805000,305293000,276809000,230279000,230987160,305978000,230927000,230111650,230938610,230985150,636014865,235081745,276005900,230937480,240609000,230941090,273390470,246371000,230109470,230011590,276829000,210974000,230110890,276636000,230063670,230983340,230613000,230367000,276696000,304010160,246271000,253418000,311055200,304051000,636092237,538006369,230112970,230645000,230991740,273339840,230654000,230113940,219076000,230648000,230103660,215871000,265411000,273335790,219996000,341469000,212308000,265762030,566917000,230992640,230038800,265314000,236112000,304146000,273359680,230983770,265732720,566054000,273355640,244093000,477524900,276490000,370467000,238251000,304519000,265585630,266232000,636017381,240864000,265767620,230939750,265725450,273355460,230181000,244689000,236592000,255805552,212949000,273326000,636092164,311066500,212357000,305295000,273246410,205689000,230987660,566583000,636015188,266027000,230631000,265883000,245241000,246650000,244101000,235083559,259319000,273313900,244995000,219175000,376819000,230033790,209029000,244890000,220236000,246447000,232157000,273516400,357411000,266438000,215782000,353778000,304625000,266041000,220404000,273384030,256076000,235006670,265734000,230007910,230303000,373473000,245315000,564520000,273543630,273241010,230651000,259721000,538005705,265004000,636012800,235094204,257426000,230987000,636016149,354449000,248075000,636011642,230623000,236111731,236490000,305883000,248886000,245046000,304958000,273538310,245656000,257667000,210853000,230659000,245457000,357562000,230012280,230011270,230111090,230022910,257222000,230033880,245180000,636012813,257970000,230992170,566024000,341337000,230033400,230990260,240244000,230001,230938570,230110310,306885000,477137400,230081290,255805837,230941170,246140000,230987940,209694000,244850854,249501000,230350000,273388150,230940190,230989380,230938560,273325230,230982010,258313000,249627000,230061400,230108490,230983370,230994870,230990880,230629000,230182000,265593530,235010600,230325000,230937650,230622000,255805880,246264000,230935000,230011290,230992260,636092323,230068740,566230000,636016950,229272000,230212000,210319000,325692000,230981770,246029000,246661000,304752000,273315940,636014069,230992750,244150000,230987410,230172000,230145000,230981160,210230000,276548000,230125910,230046140,230634000,276798000,230946000,230980760,230245000,230942970,230995000,304955000,230017340,230277000,305734000,235097855,230992210,230044260,230283000,230051080,266308000,230036770,230991780,212423000,265588920,311996000,351539000,636017466,230991010,273436370,230604000,636092412,276813000,244554000,230081740,266301000,230356000,230079670,230992710,230992280,255804280,230610000,276415000,230985210,230052810,212575000,477655300,230995290,230664000,210434000,255805917,273389560,230115340,236643000,412478730,265519660,230090460,538006370,230006000,230003110,276784000,276747000,245091000,273435680,230291000,230017370,230070870,245278000,325741000,210426000,230110670,276486000,249928000,230995680,230110910,265604550,209664000,230355000,235011600,230992590,230995650,538005402,273126000,230202000,538005404,246830000,230114690,247304300,231774000,230304000,276462000,273330930,230052840,230025470,230987550,230341000,230953000,230987390,230065310,230275000,230984450,273332400,230028850,230024000,276342000,230018240,230964000,276815000,212209000,265527480,276003580,276807000,245147000,636014587,230986740,230017000,244860255,230008800,276554000,219178000,230945000,276816000,273382350,230290000,230985000,244519000,256791000,373465000,276810000,249283000,230343000,230035990,230984090,230992580,230994000,230276000,230617000,265518890,230302000,566014000,276329000,230655000,230012460,230301000,314336000,276432000,230987870,249362000,212573000,273357510,273396370,249865000,304010318,236296000,230982000,230108270,230108610,209467000,304653000,230992670,266439000,236153000,230992680,246436000,230661000,245394000,374821000,230994880,230985490,276143000,230046580,230024490,230112370,236195000,538005197,209857000,212118000,244338000,276509000,230656000,245959000,231023000,236333000,273316800,230939640,273358960,230035100,276551000,376556000,276818000,373208000,265563260,636090879,306051000,236223000,236516000,273391690,244750397,244735000,477700600,273434680,230992690,212491000,636015944,636092746,276456000,210495000,273317640,265068000,636016808,245806000,273355410,248078000,636014354,6874356,265604520,477328400,276519000,566837000,276578000,245097000,249238000,265413000,230993000,212838000,230642000,255805557,259890000,219082000,275430000,538005505,265044000,230992540,229246000,249841000,273342810,636092093,244850226,246141000,236509000,265502100,111265586,212706000,273356260,246883000,249211000,477170800,355254000,664288000,636016012,230940140,258152000,255805672,255805594,245909000,311014100,305773000,636091934,258967000,244264000,218809000,305861000,642122021,240531000,273334820,477711300,636015187,305509000,266450000,244912000,273389730,212521000,209876000,255805693,538005246,255805606,249272000,308654000,636014189,215420000,235101907,210505000,246554000,273319230,220500000,230011390,310398000,230226000,236646000,235035113,564860000,636091096,236300000,255805939,230191000,477046300,246521000,245897000,209211000,266129000,636092731,305014000,311663000,477537200,311066200,219560000,245535000,636092197,257374000,229241000,265586980,305148000,235634000,241136000,220638000,266247000,215432000,244482000,249866000,273334320,273910100,273540330,273131400,273376280,273549230,273436530,257555000,212663000,256495000,273362790,273359960,265585920,244900091,265703040,636016683,245223000,265522160,230106860,209813000,229536000,265530460,231024000,231841000,229614000,245377000,273440330,265628650,265609490,246823000,215359000,273349020,256016000,273426540,636017658,304677000,265192000,266287000,636015295,212552000,215760000,244870420,220052000,235008920,258626000,276003360,276827000,265508760,265865000,273444880,538002938,273446880,273444250,273311070,236111827,273545330,276005280,255805938,229732000,311852000,265612620,265630020,636017117,229599000,244790715,265656810,215110000,255803880,244864000,304140000,246452000,256850000,257159000,304010297,538004642,215545000,308512000,211234480,311816000,273346620,311053400,538006473,256416000,244998000,636014588,244828000,235113663,248621000,245739000,273310400,261510000,230601000,266036000,265520400,273349470,265704520,249377000,636092297,258681000,538090268,230034510,212709000,265567430,230663000,538005397,229881000,275183000,256295000,304010515,259936000,235103765,265530860,377664000,236111951,277504000,265523890,246169000,265633770,477016800,273454300,256632000,111265584,273445880,273441620,273337240,265609500,273449020,273350220,273458560,273399790,231844000,273353190,273369610,373413444,273356720,211330520,538005700,248770000,257136000,244826000,220561000,245261000,636015205,209662000,230997540,230357000,265897000,266035000,210684000,249217000,236038000,255805916,230204000,265549580,265607880,265519620,564867000,477195700,210852000,636015736,265317000,265522530,246396000,265547840,564180000,265522520,265649350,304913000,265182000,276691000,265067000,265512110,566577000,308803000,265518260,235070241,311379000,305791000,245727000,276421000,244703000,276522000,273124000,276588000,241343000,257385000,230632000,273338540,356101000,230666000,233234000,477264700,215497000,230005640,538004731,241473000,376593000,219083000,212584000,266266000,273340570,212253000,259372000,259769000,265615670,265710830,266271000,265686750,265327000,265581580,265508900,265512390,265585620,265524100,235012220,265533480,265631420,265630250,538090400,265519440,265878000,230980670,538007287,246199000,265650800,265530830,265584790,229448000,265586010,231025000,273123000,304111000,265611640,273317850,273136100,244768000,636017585,266273000,275463000,266202000,246598000,305373000,538002614,636016290,245870000,636017575,256439000,211409100,240175000,218057000,215681000,563877000,220125000,276629000,564409000,229631000,245912000,259006000,212723000,240547000,306832000,246843000,229025000,273383610,305675000,220235000,231794000,236277000,305318000,249624000,636017177,304010685,636015904,257872000,230942260,305260000,212613000,305706000,304833000,355363000,277324000,258751000,273316400,244003000,235101274,538090265,273356870,215182000,352408000,305631000,538003924,538005398,372723000,319161000,275456000,247102500,354306000,273351240,477588400,477197100,236631000,229606000,246706000,230111350,209840000,273435220,210607000,305981000,636014356,255805555,236166000,308874000,247698000,235011610,273351780,240243000,305671000,230940290,247697000,235090537,235082802,636013840,636017222,244642000,209722000,341999999,299999999,563290000,636016448,255805875,273334240,305067000,265538450,236119000,211852000,209810000,265522510,273431470,230991670,538006432,725001321,230018000,304010444,238013000,312044000,212231000,273343810,230948000,636014191,273316200,563868000,273413060,230941690,218019000,212008000,273336330,265737860,265719480,265513420,265506010,265592200,265592570,265586470,244036000,265505420,265514720,265618270,265650820,265514710,265518870,230015000,265510570,265738560,265653620,265674760,265719470,265558290,265589970,265546930,265523880,265588850,265649360,265505410,218667000,230031000,265871000,230997510,265514730,265507520,255804460,240335000,248178000,245952000,236150000,265522680,209777000,255805955,265663480,273354700,273457410,304080000,265609540,273370120,273332320,273386110,273364290,273335320,230965000,373331000,273315900,273315070,265549230,273315430,538005405,538003719,273546420,230988040,230063050,266333000,265632540,566907000,308511000,305443000,636092478,273310900,477102800,375354000,538005466,229214000,357388000,305653000,246867000,538001652,276804000,244901000,636014355,538005468,236586000,306834000,215637000,273385460,273545420,236262000,538006621,244860325,219015298,265605830,265546890,273350110,249453000,235108405,276529000,236584000,249003000,636091997,373862000,273319850,265521240,477698300,230942800,373428000,265586630,265536500,244870327,244772000,244956000,246125000,255623000,246257000,246546000,212946000,265518710,275421000,273398790,265513190,218706000,636017495,245468000,311973000,564955000,273326400,305018000,245834000,245286000,265756810,311000367,357100000,205094000,248216000,230063110,304944000,265604510,244810617,305198000,231805000,249231000,265549180,273332640,265066000,273436030,273449820,273367610,273458950,273434590,273456410,273447920,215811000,236596000,273333440,246754000,538006503,477519500,375752000,236108000,218292000,209432000,241153000,246535000,636015448,212857000,276752000,273337270,209448000,232160000,211265530,218098000,357773000,273374820,314152000,374460000,229843000,229879000,211315100,538005166,244376000,538006769,212777000,567444000,273393190,273395690,305170000,636015879,230052040,265546900,265590560,265549210,265611390,265703010,265609080,265508580,265577460,265522500,265604470,230992140,246725000,235060255,238252000,308705000,245634000,230981210,636008972,308668000,636016281,211397660,273363000,209207000,244590000,249465000,271042763,212537000,305468000,245258000,636016280,636017209,304079000,229912000,209368000,244770393,275434000,244976000,212182000,212065000,636016011,636015204,636091854,212536000,636092743,230336000,230352000,258682000,230085580,231842000,305274000,265634350,265537680,246798000,235066012,636091859,212702000,256956000,477832100,636091030,311000433,538006467,276437000,209273000,273448600,212518000,273350170,477588300,212186000,273388120,636092301,210008000,273333950,269806000,265579740,306451000,265675310,265692080,265522490,265703540,210112000,265507630,265514750,265721770,265601260,265520420,265652720,245930000,265348000,273444990,273334710,273133800,273537310,212385000,273541530,273315660,245190000,311995000,477163100,209924000,357632000,218044000,273339460,265604500,255805768,265528920,356364000,305676000,246286000,230111110,636016278,240350000,273337230,538005564,304914000,247265800,258692000,246787000,249399000,311005600,245854000,304323000,265548410,265568520,265524530,265617170,265757820,265321000,265609530,276513000,266416000,258849000,219939000,209143000,245639000,352985000,275035000,305976000,244830834,235060914,261526000,311058100,205366000,277466000,265226000,241156000,265515570,265730260,219431000,256793000,271042510,275415000,236611000,265616910,538004941,218627000,304713000,273142300,273332570,220234000,209055000,231754000,305507000,636017655,636011641,236568000,244707000,305799000,305770000,244860007,246767000,220545000,210084000,245871000,240463000,304877000,305049000,371471000,538006505,249749000,235060248,230126940,111265587,636015281,305486000,212436000,235060251,266252000,538003882,241372000,265754440,245088000,244850853,538006123,636092405,538006506,218551000,230045240,230985740,311128000,273333320,314420000,231701000,245958000,212240000,636016295,212571000,220384000,256341000,210072000,219157000,305672000,214181517,245279000,255805754,265547830,219339000,305184000,636014353,244780424,244790369,249287000,538006220,219012959,305881000,230339000,273362000,219018272,305837000,247604000,249246000,305119000,236147000,246542000,566025000,273380460,548922000,249772000,636016260,248811000,246134000,305980000,636015977,305904000,229616000,565568000,245176000,215211000,305771000,246779000,305614000,236654000,246412000,229668000,636092421,304010285,564216000,566840000,273318820,538003695,255805753,244790509,311062400,258747000,538006772,219571000,212795000,566839000,636013322,376317000,231791000,246602000,249500000,230044550,249776000,210207000,273353680,273358260,246699000,218110000,244114000,258915000,566579000,355194000,249380000,246457000,265515720,305286000,230050090,246845000,248036000,273338250,215663000,240290000,212801000,276006070,230038140,309924000];

        var lines = [];

        function connect() {
            console.log('trying to connect...');

            //var socket = new WebSocket('ws://localhost:9001/api/v1/plain-websockets/locations/230006760');
            var socket = new WebSocket('ws://meri-test.digitraffic.fi/api/v1/plain-websockets/locations');

            console.info('Socket is ' + socket.readyState);

            socket.onopen = function (event) {
                console.info('Socket is open');
            }

            socket.onmessage = function(message) {
                //console.info("message :" + message.data)
                addMessage(JSON.parse(message.data));
                updateList();
            };
        }

        function addMessage(message) {
            var text = convert(message);

            if (lines.length > 100) {
                lines.shift();
            }

            lines.push(text);
        }

        function updateList() {
            $(".locations").html(lines.join('<br/>'));
        }

        function convert(message) {
            if (typeof message.attributes !== 'undefined' && typeof message.attributes.mmsi !== 'undefined') {
                var mmsi = message.attributes.mmsi;
                if ($.inArray(mmsi, notAllowed) >= 0) {
                    console.info("Not allowed " + message.attributes.mmsi);
                } else if ($.inArray(mmsi, allowed) >= 0) {
                    //console.info("Allowed " + message.attributes.mmsi);
                    var i = 0;
                } else {
                    console.info("No metadata " + message.attributes.mmsi);
                }

                return 'mmsi: ' + message.attributes.mmsi + ':\t ' + JSON.stringify(message);
            }
        }



        connect();
    </script>
</head>
<body>
    Vessel locations:
    <div class="locations" />
</body>
</html>
